"""
Before running this script, create an empty ArcGIS Pro project (.aprx).
"""

# Section 1: Setup

# 1.1 Importing ArcPy and custom map/layout functions
import arcpy
from function import create_single_map, create_standard_layout

# 1.2 Loading ArcGIS Pro project and define file paths
# path where empty project is stored
aprx = arcpy.mp.ArcGISProject(
    r"C:\Users\Public\ArcGis project\ArcGis project.aprx"
)

# path where shapefiles are stored
arcpy.env.overwriteOutput = True

original_data_path = (
    r"C:\Users\hashi\OneDrive - Higher Education Commission\Desktop"
    r"\Uchicago Classes\Quarter 4\GIS\Final Project\Final"
    r"\Shapefiles\harris_underinsurance.shp"
)

copy_data_path = (
    r"C:\Users\Public\ArcGis project\harris_underinsurance_edit.shp"
)

# Creating a working copy of the data
arcpy.management.CopyFeatures(original_data_path, copy_data_path)




# Section 2: Creating Maps
# 2.1: Removing any existing maps in the project
for m in aprx.listMaps():
    aprx.deleteItem(m)

# 2.2: Flood risk classification map
# Labelling categories
risk_labels = {
    0: "No Rating",
    1: "Very Low",
    2: "Relatively Low",
    3: "Relatively Moderate",
    4: "Relatively High",
    5: "Very High"
}

risk_map, risk_layer = create_single_map(
    map_name="risk_map",
    layer_path=copy_data_path,
    layer_name="harris_underinsurance",
    renderer="UniqueValueRenderer",
    variable_name="RFLD_RIS_1",
    color_map="Yellow-Green-Blue (6 Classes)",
    label_map=risk_labels
)


# 2.3 Insurance gap classification map
insurance_gap_labels = {
    -1: "No Gap",
    0: "Low Gap",
    1: "Medium Gap",
    2: "High Gap"
}

insurance_map, insurance_layer = create_single_map(
    map_name="insurance_map",
    layer_path=copy_data_path,
    layer_name="harris_underinsurance",
    renderer="UniqueValueRenderer",
    variable_name="jenks_clas",
    color_map="Yellow-Green-Blue (4 Classes)",
    label_map=insurance_gap_labels
)




# Section 3: Creating Layouts

# 3.1: Removing existing layouts
for layout in aprx.listLayouts():
    aprx.deleteItem(layout)

# 3.2: Layout for flood risk map
risk_layout = create_standard_layout(
    map_obj=risk_map,
    layer=risk_layer,
    layout_name="risk_layout",
    title_text="Figure 1: Flood Risk Index in Harris County, Texas"
)

# 3.3: Layout for insurance gap map
insurance_layout = create_standard_layout(
    map_obj=insurance_map,
    layer=insurance_layer,
    layout_name="insurance_layout",
    title_text="Figure 2: Insurance Gap in Harris County, Texas"
)




# Section 4: Saving Project and Exporting Outputs

aprx.save()

output_risk_layout = r"C:\Users\Public\ArcGis project\layout_1.png"
output_insurance_layout = r"C:\Users\Public\ArcGis project\layout_2.png"

risk_layout.exportToPNG(output_risk_layout, resolution=300)
insurance_layout.exportToPNG(output_insurance_layout, resolution=300)
